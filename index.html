<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASH_INDAIA | Dashboard de Vendas</title>
    
    <!-- Fonts: Inter for that modern SaaS look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons: FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* --- Color Palette (Green SaaS Theme) --- */
            
            /* Primary Accents */
            --primary: #10b981;       /* Emerald 500 */
            --primary-dark: #047857;  /* Emerald 700 */
            --primary-light: #d1fae5; /* Emerald 100 */
            
            /* Sidebar & Dark Elements */
            --sidebar-bg: #064e3b;    /* Deep Forest Green */
            --sidebar-hover: #065f46;
            --sidebar-text: #ecfdf5;
            
            /* Backgrounds */
            --bg-body: #f3f4f6;       /* Gray 100 */
            --bg-card: #ffffff;
            
            /* Text */
            --text-main: #111827;     /* Gray 900 */
            --text-secondary: #6b7280;/* Gray 500 */
            
            /* Borders & Shadows */
            --border: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            
            /* Dimensions */
            --sidebar-width: 260px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LOADING SPINNER --- */
        #loader {
            position: fixed;
            top: 0; 
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loader-text {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 20;
        }

        .brand {
            height: var(--header-height);
            display: flex;
            align-items: center;
            padding: 0 24px;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.025em;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .brand i { margin-right: 10px; color: var(--primary); }

        .nav-menu {
            padding: 24px 16px;
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 4px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-item.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .nav-item i { width: 20px; margin-right: 12px; font-size: 1rem; }

        .sidebar-footer {
            padding: 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
            text-align: center;
        }

        /* --- MAIN LAYOUT --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- TOP HEADER --- */
        .header {
            height: var(--header-height);
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            flex-shrink: 0;
            z-index: 10;
        }

        .page-title h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .page-title p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Search Bar Visual */
        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--bg-body);
            border: 1px solid transparent;
            border-radius: 8px;
            padding: 8px 16px;
            width: 280px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            transition: 0.2s;
        }
        .search-box:focus-within {
            background-color: white;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-light);
        }
        .search-box i { margin-right: 10px; color: #9ca3af; }
        .search-box input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            color: var(--text-main);
        }

        .timestamp {
            font-size: 0.75rem;
            font-weight: 600;
            background-color: var(--primary-light);
            color: var(--primary-dark);
            padding: 6px 12px;
            border-radius: 20px;
        }

        /* --- SCROLL AREA --- */
        .scroll-container {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- CARDS GRID --- */
        .grid-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        /* Card Style */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Colored Line Indicator on Left */
        .card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
        }

        .card.accent-green::before { background-color: var(--primary); }
        .card.accent-blue::before { background-color: #3b82f6; }
        .card.accent-purple::before { background-color: #a855f7; }
        .card.accent-orange::before { background-color: #f97316; }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .card-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .icon-box {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        /* Icon Colors */
        .ib-green { background: #ecfdf5; color: var(--primary); }
        .ib-blue { background: #eff6ff; color: #3b82f6; }
        .ib-purple { background: #faf5ff; color: #a855f7; }
        .ib-orange { background: #fff7ed; color: #f97316; }

        .card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-main);
            line-height: 1.2;
        }

        .card-sub {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 4px;
            font-weight: 500;
        }
        
        .text-trend { color: var(--primary); font-size: 0.8rem; }

        /* --- TABLES --- */
        .grid-tables {
            display: grid;
            grid-template-columns: 3fr 2fr; /* 60/40 Split */
            gap: 24px;
        }

        .table-card {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 500px; /* Fixed height for scroll */
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: #fcfcfc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-main);
        }

        .table-wrapper {
            flex: 1;
            overflow: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        th {
            background: #f9fafb;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            padding: 12px 24px;
            text-align: left;
            position: sticky;
            top: 0;
            border-bottom: 1px solid var(--border);
            z-index: 5;
        }

        td {
            padding: 14px 24px;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            white-space: nowrap;
        }

        tr:hover td { background-color: #f9fafb; }

        .status-pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            background: #f3f4f6;
            color: var(--text-secondary);
        }
        .status-pill.good { background: #ecfdf5; color: var(--primary-dark); }
        .status-pill.warn { background: #fff7ed; color: #c2410c; }

        .text-right { text-align: right; }
        .font-bold { font-weight: 600; }

        .empty-state {
            padding: 40px;
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 1200px) {
            .grid-tables { grid-template-columns: 1fr; }
            .table-card { height: auto; max-height: 500px; }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; } /* Simplified mobile view */
            .header { padding: 0 16px; }
            .scroll-container { padding: 16px; }
            .grid-dashboard { grid-template-columns: 1fr; }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "@heroicons/react/": "https://aistudiocdn.com/@heroicons/react@^2.2.0/"
  }
}
</script>
</head>
<body>

    <!-- Loading Overlay -->
    <div id="loader">
        <div class="spinner"></div>
        <p class="loader-text">Conectando ao Google Sheets...</p>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-chart-simple"></i>
            DASH_INDAIA
        </div>
        <nav class="nav-menu">
            <a href="#" class="nav-item active">
                <i class="fa-solid fa-table-columns"></i> Dashboard
            </a>
            <a href="#" class="nav-item">
                <i class="fa-solid fa-user-group"></i> Leads & Vendas
            </a>
            <a href="#" class="nav-item">
                <i class="fa-solid fa-wand-magic-sparkles"></i> AI Analyst
            </a>
            <a href="#" class="nav-item">
                <i class="fa-solid fa-sliders"></i> Configurações
            </a>
            <a href="#" class="nav-item">
                <i class="fa-regular fa-circle-question"></i> Ajuda
            </a>
        </nav>
        <div class="sidebar-footer">
            &copy; 2024 Indaia System v1.0
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="page-title">
                <h1>Dashboard de Vendas</h1>
                <p>Visão geral dos leads e desempenho comercial</p>
            </div>
            <div class="header-actions">
                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" placeholder="Pesquisar campanha, vendedor...">
                </div>
                <div class="timestamp" id="lastUpdated">
                    <i class="fa-regular fa-clock"></i> Atualizando...
                </div>
            </div>
        </header>

        <!-- Dashboard Body -->
        <div class="scroll-container">
            
            <!-- SECTION 1: Visão Geral -->
            <div class="section-title">
                <i class="fa-solid fa-chart-pie"></i> Visão Geral
            </div>
            
            <div class="grid-dashboard">
                <!-- Investimento -->
                <div class="card accent-blue">
                    <div class="card-top">
                        <span class="card-label">Investimento Total</span>
                        <div class="icon-box ib-blue"><i class="fa-solid fa-wallet"></i></div>
                    </div>
                    <div>
                        <div class="card-value" id="val-investimento">R$ 0,00</div>
                        <div class="card-sub">Investido em Mídia</div>
                    </div>
                </div>

                <!-- Faturamento -->
                <div class="card accent-green">
                    <div class="card-top">
                        <span class="card-label">Faturamento</span>
                        <div class="icon-box ib-green"><i class="fa-solid fa-sack-dollar"></i></div>
                    </div>
                    <div>
                        <div class="card-value" id="val-faturamento">R$ 0,00</div>
                        <div class="card-sub">Receita Gerada</div>
                    </div>
                </div>

                <!-- ROI -->
                <div class="card accent-purple">
                    <div class="card-top">
                        <span class="card-label">ROI Global</span>
                        <div class="icon-box ib-purple"><i class="fa-solid fa-arrow-trend-up"></i></div>
                    </div>
                    <div>
                        <div class="card-value" id="val-roi">0.00</div>
                        <div class="card-sub text-trend" id="val-roas">ROAS: 0.00x</div>
                    </div>
                </div>

                <!-- Vendas -->
                <div class="card accent-orange">
                    <div class="card-top">
                        <span class="card-label">Vendas Totais</span>
                        <div class="icon-box ib-orange"><i class="fa-solid fa-file-contract"></i></div>
                    </div>
                    <div>
                        <div class="card-value" id="val-vendas">0</div>
                        <div class="card-sub">Contratos Fechados</div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: Funil -->
            <div class="section-title">
                <i class="fa-solid fa-filter"></i> Funil de Leads
            </div>

            <div class="grid-dashboard">
                <!-- Leads Hoje -->
                <div class="card accent-blue">
                    <div class="card-top">
                        <span class="card-label">Leads Hoje</span>
                        <div class="icon-box ib-blue"><i class="fa-regular fa-calendar-check"></i></div>
                    </div>
                    <div class="card-value" id="val-leads-hoje">0</div>
                </div>

                <!-- Leads Período -->
                <div class="card accent-blue">
                    <div class="card-top">
                        <span class="card-label">Leads (Período)</span>
                        <div class="icon-box ib-blue"><i class="fa-solid fa-users"></i></div>
                    </div>
                    <div class="card-value" id="val-leads-periodo">0</div>
                </div>

                <!-- CPL -->
                <div class="card accent-green">
                    <div class="card-top">
                        <span class="card-label">Custo por Lead (CPL)</span>
                        <div class="icon-box ib-green"><i class="fa-solid fa-tag"></i></div>
                    </div>
                    <div class="card-value" id="val-cpl">R$ 0,00</div>
                </div>

                <!-- CPA -->
                <div class="card accent-green">
                    <div class="card-top">
                        <span class="card-label">Custo p/ Venda (CPA)</span>
                        <div class="icon-box ib-green"><i class="fa-solid fa-hand-holding-dollar"></i></div>
                    </div>
                    <div class="card-value" id="val-cpa">R$ 0,00</div>
                </div>
            </div>

            <!-- SECTION 3: Tables -->
            <div class="grid-tables">
                
                <!-- Campanhas Table -->
                <div class="table-card">
                    <div class="table-header">
                        <span class="table-title">Performance por Campanha</span>
                        <button style="border:none; background:none; color:var(--primary); cursor:pointer;">
                            <i class="fa-solid fa-download"></i>
                        </button>
                    </div>
                    <div class="table-wrapper">
                        <table id="tbl-campanhas">
                            <thead>
                                <tr>
                                    <th>Campanha</th>
                                    <th>Plataforma</th>
                                    <th class="text-right">Leads</th>
                                    <th class="text-right">Vendas</th>
                                    <th class="text-right">CPA</th>
                                    <th class="text-right">Conv. (%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS Populates Here -->
                            </tbody>
                        </table>
                        <div id="msg-campanhas" class="empty-state" style="display:none;">
                            Nenhuma campanha encontrada no período.
                        </div>
                    </div>
                </div>

                <!-- Equipe Table -->
                <div class="table-card">
                    <div class="table-header">
                        <span class="table-title">Ranking Comercial</span>
                    </div>
                    <div class="table-wrapper">
                        <table id="tbl-vendedores">
                            <thead>
                                <tr>
                                    <th>Vendedor</th>
                                    <th class="text-right">Leads</th>
                                    <th class="text-right">Contratos</th>
                                    <th class="text-right">Conv.</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS Populates Here -->
                            </tbody>
                        </table>
                        <div id="msg-vendedores" class="empty-state" style="display:none;">
                            Nenhum dado de vendas encontrado.
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </main>

    <!-- JavaScript Logic -->
    <script>
        // --- Formatters ---
        const BRL = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        const NUM = new Intl.NumberFormat('pt-BR');
        const DEC = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const PCT = new Intl.NumberFormat('pt-BR', { style: 'percent', minimumFractionDigits: 1 });

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            carregarDashboard();
        });

        function mostrarSpinner(show) {
            const loader = document.getElementById('loader');
            loader.style.opacity = show ? '1' : '0';
            loader.style.pointerEvents = show ? 'all' : 'none';
        }

        function carregarDashboard() {
            mostrarSpinner(true);

            // Check if running in GAS context
            if (typeof google === 'undefined' || !google.script) {
                console.warn('Google Script context not found. Backend calls will fail locally.');
                // In a real local dev scenario we might mock here, but the prompt asked for pure logic 
                // ready for GAS. We'll show an alert after a timeout to prevent infinite load in dev.
                setTimeout(() => {
                    mostrarSpinner(false);
                    alert("Atenção: Este painel precisa rodar dentro do Google Apps Script.");
                }, 1500);
                return;
            }

            google.script.run
                .withSuccessHandler(onSuccess)
                .withFailureHandler(onFailure)
                .getDashboardData(null); // Passing null as filters
        }

        function onSuccess(data) {
            mostrarSpinner(false);
            
            if (!data) {
                alert('O servidor retornou vazio.');
                return;
            }

            if (data.error) {
                alert('Erro do servidor: ' + data.message);
                return;
            }

            console.log("Dados recebidos:", data);
            
            // 1. Update Timestamp
            const now = new Date();
            document.getElementById('lastUpdated').innerHTML = 
                `<i class="fa-regular fa-clock"></i> Atualizado: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;

            // 2. Overview Cards
            // Keys come from Code.gs: totalInvestimento, faturamentoPeriodo, roiGlobal, roasGlobal, totalContratosPeriodo
            document.getElementById('val-investimento').textContent = BRL.format(data.totalInvestimento || 0);
            document.getElementById('val-faturamento').textContent = BRL.format(data.faturamentoPeriodo || 0);
            document.getElementById('val-roi').textContent = DEC.format(data.roiGlobal || 0);
            document.getElementById('val-roas').textContent = `ROAS: ${DEC.format(data.roasGlobal || 0)}x`;
            document.getElementById('val-vendas').textContent = NUM.format(data.totalContratosPeriodo || 0);

            // 3. Funnel Cards
            // Keys: totalLeadsHoje, leadsPeriodo, cplGlobal, cpaGlobal
            document.getElementById('val-leads-hoje').textContent = NUM.format(data.totalLeadsHoje || 0);
            document.getElementById('val-leads-periodo').textContent = NUM.format(data.leadsPeriodo || 0);
            document.getElementById('val-cpl').textContent = BRL.format(data.cplGlobal || 0);
            document.getElementById('val-cpa').textContent = BRL.format(data.cpaGlobal || 0);

            // 4. Tables
            // Keys: kpiCampanhas, kpiVendedores
            renderTableCampanhas(data.kpiCampanhas || []);
            renderTableVendedores(data.kpiVendedores || []);
        }

        function onFailure(error) {
            mostrarSpinner(false);
            alert('Falha ao conectar com a planilha: ' + error.message);
        }

        function renderTableCampanhas(lista) {
            const tbody = document.querySelector('#tbl-campanhas tbody');
            const msg = document.getElementById('msg-campanhas');
            const table = document.getElementById('tbl-campanhas');

            tbody.innerHTML = '';

            if (lista.length === 0) {
                table.style.display = 'none';
                msg.style.display = 'block';
                return;
            }
            
            table.style.display = 'table';
            msg.style.display = 'none';

            lista.forEach(item => {
                const tr = document.createElement('tr');
                
                // Fields from Code.gs: CAMPANHA, PLATAFORMA, LEADS_TOTAL, CONTRATOS, CPL, CUSTO_POR_CONTRATO, TX_FECHAMENTO
                // Note: Code.gs returns uppercase keys if it uses the header row directly, 
                // OR it returns specific camelCase if the backend mapped it.
                // Looking at Prompt 1 output: it mapped to camelCase? No, Prompt 1 Code.gs used getSheetDataAsObjects_ 
                // which uses the header string as key. The headers in Sheet are uppercase (CAMPANHA, PLATAFORMA...).
                // HOWEVER, the Prompt 1 Code.gs *return object* mapped `campanhasResumo` -> `kpiCampanhas` 
                // but the `kpiCampanhas` const was just the raw object array from `getSheetDataAsObjects_`.
                // So keys are UPPERCASE based on the sheet headers described in prompt 1.
                
                // Let's handle uppercase keys safely.
                
                const leads = item.LEADS_TOTAL || 0;
                const vendas = item.CONTRATOS || 0;
                const cpa = item.CUSTO_POR_CONTRATO || 0;
                
                // Taxa Conversão
                let tx = item.TX_FECHAMENTO;
                if (tx === undefined || tx === '') {
                    // Fallback calc
                    tx = leads > 0 ? (vendas / leads) : 0;
                }

                tr.innerHTML = `
                    <td class="font-bold">${item.CAMPANHA || 'Desconhecido'}</td>
                    <td><span class="status-pill" style="background:#f3f4f6;">${item.PLATAFORMA || '-'}</span></td>
                    <td class="text-right">${NUM.format(leads)}</td>
                    <td class="text-right">${NUM.format(vendas)}</td>
                    <td class="text-right">${BRL.format(cpa)}</td>
                    <td class="text-right">
                        <span class="status-pill ${tx >= 0.1 ? 'good' : 'warn'}">
                            ${PCT.format(tx)}
                        </span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderTableVendedores(lista) {
            const tbody = document.querySelector('#tbl-vendedores tbody');
            const msg = document.getElementById('msg-vendedores');
            const table = document.getElementById('tbl-vendedores');

            tbody.innerHTML = '';

            if (lista.length === 0) {
                table.style.display = 'none';
                msg.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            msg.style.display = 'none';

            lista.forEach(item => {
                const tr = document.createElement('tr');
                // Keys: VENDEDOR, LEADS, CONTRATOS, FATURAMENTO...
                
                const leads = item.LEADS || 0;
                const vendas = item.CONTRATOS || 0;
                const conv = leads > 0 ? (vendas / leads) : 0;

                tr.innerHTML = `
                    <td class="font-bold">${item.VENDEDOR || 'Vendedor'}</td>
                    <td class="text-right">${NUM.format(leads)}</td>
                    <td class="text-right">${NUM.format(vendas)}</td>
                    <td class="text-right">
                        <span class="status-pill ${conv >= 0.1 ? 'good' : 'warn'}">
                            ${PCT.format(conv)}
                        </span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>